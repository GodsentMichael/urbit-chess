# Urbit Chess

Play chess over Urbit. Fully peer-to-peer. Stores your games in gall, and allows
you to export them to PGN.

Visit the Urbit Chess Federation at ~ponrep/urbit-chess-federation for
games!

## Development

See the project hub at https://sr.ht/~ray/urbit-chess/. View issues on
and submit issues to the [issue tracker](https://todo.sr.ht/~ray/urbit-chess).
Subscribe to [`urbit-chess-announce`](https://lists.sr.ht/~ray/urbit-chess-announce)
(`~ray/urbit-chess-announce@lists.sr.ht`) for release updates, and
submit patches to [`urbit-chess-devel`](https://lists.sr.ht/~ray/urbit-chess-devel)
(`~ray/urbit-chess-devel@lists.sr.ht`). If you don't know how to submit
patches to a mailing list, the tutorial links all over Sourcehut will
help you out.

If your branch is exceptionally large (50 commits is a decent benchmark
for "exceptionally large"), I also accept pull requests (not the Github
feature, but actual pull requests, e.g. as generated by git
request-pull) at the same list.

## Known Issues

- En passant doesn't work
- Certain illegal moves will put the game into a broken state, which requires Gall app restart to fix
- Rendering a completed game fails
- Exporting games to PGN disabled

## Gall API

### Scrys provided

- `%gy /game`

  All the game IDs (both active and archived) this ship knows about.

- `%gx /game/[game-id]/chess-game`

  A chess-game containing the current state of the game.

- `%gx /game/[game-id]/pgn`

  A PGN file containing the current state of the game.

### Subscription paths provided

- `/challenges`

  All challenges received by this ship. Restricted to team.

- `/active-games`

  All active games being played by this ship. Restricted to team.

- `/game/[game-id]/updates`

  State updates on the specified game. Must be active. Gives the current
  position when first subscribed.

- `/game/[game-id]/moves`

  Move updates on the specified game. Must be active. Does not give previous
  moves when first subscribed, only updates as they come.

### Pokes accepted

- `&chess-action`

  Actions made by the chess player on this ship. Restricted to team.

- `&chess-challenge`

  Challenges to chess games from ships. Challenges are accepted by subscribing
  to a new game path on the challenger's ship.

- `&chess-decline-challenge`

  Declination of a challenge. No data.

- `&chess-draw-offer`

  Offering of a draw. No data.

- `&chess-draw-accept`

  Acceptance of a draw offer. No data.

- `&chess-draw-decline`

  Refusal of a draw offer. No data.

- `&chess-rng`

  A commitment to a secret, or a revelation of a secret. Used to decide random
  sides.

- `&chess-debug-inject`

  Injection of a game state under a given game ID. Used to rescue stuck
  games.

- `&chess-debug-subscribe`

  Forced subscription to a specific game path. Used to rescue stuck
  games.

- `&chess-debug-zap`

  Forced deletion of an active game. Used to remove spurious games.

### Pokes emitted

- `:file-server &file-server-action`

  Serve the frontend from /~chess.

- `:launch &launch-action`

  Create a Landscape home screen tile.

- `:ship/chess &chess-challenge`

  Challenges to other ships.

- `:ship/chess &chess-decline-challenge`

  Challenges declined from other ships. No data.

- `:ship/chess &chess-rng`

  A commitment to a secret, or a revelation of a secret. Used to decide random
  sides.

### Subscription updates emitted

- `&chess-game`

  A chess game (metadata and list of moves). Given on path /active-games
  when a game is started or when a new subscription is made to
  /active-games.

- `&chess-move`

  A move in a chess game. Given on path /game/[game-id]/moves.

- `&chess-update`

  Updates to the chess player's frontend on this ship. Given on paths
  /challenges and /game/[game-id]/positions.
